<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kamae</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #0f0f0f; /* çok koyu arka plan - göz yormaz */
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #map {
      height: 100vh;
      width: 100vw;
      background: #1a1a1a; /* koyu arka plan - harita alanı için */
    }

    /* Koyu tema - Zoom butonları ve kontroller */
    .leaflet-control-zoom {
      border: none !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5) !important;
    }

    .leaflet-control-zoom a {
      background-color: #2d2d2d !important;
      color: #e0e0e0 !important;
      border: 1px solid #444 !important;
      width: 32px !important;
      height: 32px !important;
      line-height: 32px !important;
      font-size: 18px !important;
      font-weight: bold !important;
      transition: all 0.2s ease !important;
    }

    .leaflet-control-zoom a:hover {
      background-color: #3d3d3d !important;
      color: #ffffff !important;
      border-color: #666 !important;
    }

    .leaflet-control-zoom a:active {
      background-color: #1d1d1d !important;
    }

    .leaflet-control-zoom-in {
      border-bottom: 1px solid #444 !important;
    }

    /* Harita dışındaki boş alanlar için */
    .leaflet-container {
      background: #1a1a1a !important;
    }

    /* Harita görselini karart ve arka planla uyumlu hale getir */
    img.leaflet-image-layer {
      filter: brightness(0.7) contrast(1.1);
    }

    /* Fantasy / RPG popup styling - Parşömen teması */
    .leaflet-popup-content-wrapper {
      background: #cfab77; /* Koyu bej/altın tonu */
      border-radius: 8px;
      border: 2px solid #2F4F4F; /* Koyu Yeşim Yeşili */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      color: #3d351e;
      font-family: "Cormorant Garamond", "Georgia", serif;
    }

    .leaflet-popup-tip {
      background: #cfab77;
      border: 2px solid #2F4F4F;
    }

    .popup-title {
      font-family: "Cinzel", serif;
      font-size: 1.1rem;
      margin: 0 0 0.5rem;
      color: #3d351e;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      font-weight: 700;
    }

    .popup-description {
      font-family: "Cormorant Garamond", serif;
      font-size: 0.95rem;
      line-height: 1.6;
      margin: 0;
      color: #3d351e;
      font-weight: 700;
    }

    /* Giriş ekranı overlay */
    #entry-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 4.5s ease;
    }

    #entry-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #entry-button {
      font-family: "Cinzel", serif;
      font-size: 1.5rem;
      font-weight: 600;
      padding: 18px 40px;
      background: transparent;
      color: #d4af37;
      border: 3px solid #d4af37;
      border-radius: 8px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
    }

    #entry-button:hover {
      background: rgba(212, 175, 55, 0.1);
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
      transform: scale(1.05);
    }

    #entry-button:active {
      transform: scale(0.98);
    }

    /* Vignette efekti - Kenar karartması */
    #vignette {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.6) 100%);
      pointer-events: none;
      z-index: 500;
    }

    /* Kül yağmuru efekti */
    .ash-particle {
      position: fixed;
      top: -10px;
      background: rgba(80, 75, 70, 0.7);
      border-radius: 50%;
      pointer-events: none;
      z-index: 400;
      box-shadow: 0 0 2px rgba(60, 55, 50, 0.5);
    }

    /* Kül yağmuru animasyonu - Gerçekçi süzülme ve yalpalama */
    @keyframes ash-fall {
      0% {
        transform: translateY(-10vh) translateX(0px) rotate(0deg);
        opacity: 0.8;
      }
      12.5% {
        transform: translateY(12.5vh) translateX(15px) rotate(22deg);
        opacity: 0.75;
      }
      25% {
        transform: translateY(25vh) translateX(-10px) rotate(45deg);
        opacity: 0.7;
      }
      37.5% {
        transform: translateY(37.5vh) translateX(25px) rotate(67deg);
        opacity: 0.65;
      }
      50% {
        transform: translateY(50vh) translateX(-20px) rotate(90deg);
        opacity: 0.6;
      }
      62.5% {
        transform: translateY(62.5vh) translateX(10px) rotate(112deg);
        opacity: 0.55;
      }
      75% {
        transform: translateY(75vh) translateX(-15px) rotate(135deg);
        opacity: 0.5;
      }
      87.5% {
        transform: translateY(87.5vh) translateX(5px) rotate(157deg);
        opacity: 0.3;
      }
      100% {
        transform: translateY(110vh) translateX(-10px) rotate(180deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Giriş ekranı overlay -->
  <div id="entry-overlay">
    <button id="entry-button">Kamae'ye Gir</button>
  </div>

  <!-- Vignette efekti -->
  <div id="vignette"></div>

  <!-- Kül yağmuru container -->
  <div id="ash-container"></div>

  <div id="map"></div>

  <!-- Arka plan sesi -->
  <audio id="ambience-audio" loop>
    <source src="assets/audio/ambience.mp3" type="audio/mpeg">
  </audio>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // NOTE: These should match the exact pixel dimensions of your map.webp image
    const imageWidth = 7680;  // <- image width in pixels
    const imageHeight = 4320; // <- image height in pixels

    // Define bounds in pixel coordinates: [ [top, left], [bottom, right] ]
    const imageBounds = [[0, 0], [imageHeight, imageWidth]];

    // Create the map with simple CRS (pixel-based coordinates)
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -3,   // daha düşük zoom seviyesi - haritanın tamamını görmek için
      maxZoom: 3,
      center: [imageHeight / 2, imageWidth / 2],
      zoom: -2,      // başlangıç zoom seviyesi daha düşük
      zoomSnap: 0.25,
      zoomDelta: 0.5,
      attributionControl: false
    });

    // Add the image as an overlay
    const imageOverlay = L.imageOverlay('map.webp', imageBounds).addTo(map);

    // Image yüklendikten sonra fitBounds yap - haritanın tamamını görmek için
    imageOverlay.on('load', function() {
      map.fitBounds(imageBounds, { padding: [20, 20] });
    });

    // Eğer image zaten yüklüyse (cache'den geliyorsa) hemen fitBounds yap
    if (imageOverlay._image && imageOverlay._image.complete) {
      map.fitBounds(imageBounds, { padding: [20, 20] });
    }

    // Prevent panning completely away from the image
    // Wrap imageBounds with L.latLngBounds so we can use .pad(...)
    map.setMaxBounds(L.latLngBounds(imageBounds).pad(0.5)); // padding biraz artırıldı

    // === Helper: create a city marker (dot) with name + description ===
    // Usage: addCity("Şehir Adı", "Açıklama metni...", y, x);
    function addCity(name, description, y, x) {
      const marker = L.circleMarker([y, x], {
        radius: 7,              // biraz daha büyük nokta
        color: '#ffffff',       // beyaz outline
        weight: 2,              // çok kalın olmayan kenar
        fillColor: '#000000',   // siyah dolgu
        fillOpacity: 0.95
      }).addTo(map);

      marker.bindPopup(`
        <div>
          <h3 class="popup-title">${name}</h3>
          <p class="popup-description">
            ${description}
          </p>
        </div>
      `);

      // Popup'u tıklama yerine hover ile göster
      marker.off('click'); // varsayılan tıklama ile açmayı kaldır
      marker.on('mouseover', function () {
        this.openPopup();
      });
      marker.on('mouseout', function () {
        this.closePopup();
      });

      return marker;
    }

    // === Cities (using [y, x] pixel coordinates) ===
    addCity(
      "Tenkyou",
      "Shogun'un altın surları ve hiç sönmeyen fenerleriyle geceye meydan okuyan, kıtanın atan kalbi. Halk, İmparatorluk Sarayı'nın gölgesinde, kılıçla çizilmiş kusursuz bir sessizlik ve düzen içinde yaşar.",
      2250,
      1770
    );

    addCity(
      "Fuyumori",
      "Başkentin altın sükunetine, demir ve ateşle verilmiş gürültülü bir cevap. Güney Lordu'nun hükmettiği bu şehir, adını üzerine sürekli yağan ve sokaklarını beyaza bürüyen volkanik küllerin yarattığı 'ebedi kış' manzarasından alır.",
      853,
      2131
    );

    addCity(
      "Shinju-Kyo",
      "Binlerce kağıt fenerin soluk ışığında yıkanan, yağmurun ve ipeğin hüküm sürdüğü Doğu'nun ticaret kalbi. Tüccarlar buraya 'İnci' der; çünkü dışı parlak bir zenginlikle kaplıyken, içi karanlık sırlar ve pazarlıklarla doludur.",
      1488,
      6534
    );

    // === Development helper: log pixel coordinates on click ===
    // Logs [y, x] where:
    //   y = vertical pixel coordinate (top = 0, increases downward)
    //   x = horizontal pixel coordinate (left = 0, increases to the right)
    map.on('click', function (e) {
      const y = Math.round(e.latlng.lat);
      const x = Math.round(e.latlng.lng);
      console.log('[y, x] =', [y, x]);
    });

    // === Kül yağmuru efekti ===
    function createAshFall() {
      const ashContainer = document.getElementById('ash-container');
      const particleCount = Math.floor(Math.random() * 11) + 60; // 60-70 arası rastgele

      for (let i = 0; i < particleCount; i++) {
        const ash = document.createElement('div');
        ash.className = 'ash-particle';

        // Rastgele özellikler
        const size = Math.random() * 3 + 2; // 2px - 5px
        const left = Math.random() * 100; // 0% - 100%
        const opacity = Math.random() * 0.4 + 0.4; // 0.4 - 0.8
        const duration = Math.random() * 7 + 8; // 8s - 15s
        const delay = Math.random() * 5; // 0s - 5s gecikme

        ash.style.width = size + 'px';
        ash.style.height = size + 'px';
        ash.style.left = left + '%';
        ash.style.opacity = opacity;
        ash.style.animation = `ash-fall ${duration}s linear ${delay}s infinite`;

        ashContainer.appendChild(ash);
      }
    }

    // Sayfa yüklendiğinde kül yağmurunu başlat
    createAshFall();

    // === Giriş ekranı ve ses yönetimi ===
    const entryOverlay = document.getElementById('entry-overlay');
    const entryButton = document.getElementById('entry-button');
    const ambienceAudio = document.getElementById('ambience-audio');

    // Ses seviyesini ayarla
    ambienceAudio.volume = 0.4;

    // Butona tıklandığında overlay'i kaldır ve sesi başlat
    entryButton.addEventListener('click', function() {
      // Overlay'i fade out yap
      entryOverlay.classList.add('hidden');
      
      // Ses çalmayı dene (kullanıcı etkileşimi gerektiği için)
      ambienceAudio.play().catch(function(error) {
        console.log('Ses çalınamadı (kullanıcı etkileşimi gerekebilir):', error);
      });

      // Overlay'i DOM'dan kaldır (transition tamamlandıktan sonra)
      setTimeout(function() {
        entryOverlay.remove();
      }, 4500); // CSS transition süresi ile eşleşmeli (4.5s)
    });
  </script>
</body>
</html>


